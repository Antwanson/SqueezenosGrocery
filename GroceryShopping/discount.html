<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Discounts</title>
<link href="assets/css/bootstrap.css" rel="stylesheet">
<link href="assets/css/main.css" rel="stylesheet">
</head>

<body>
<nav class="navbar">
	<ul>
		<li><a href="history.html">History</a></li>
		<li><a href="orders.html">Orders</a></li>
		<li><a href="users.html">Users</a></li>
		<li><a href="sale.html">Sales</a></li>
		<li><a class="active" href="discount.html">Discounts</a></li>
		<li><a href="modify.html">Modify Items</a></li>
		<li><a href="index.html">Home</a></li>
	</ul>
</nav>
	
<h1>Discounts</h1>
<div class="vertical"></div>
<div class="content">
	<div class="left-content">
		<h2>Create Discount</h2>
		<form id="createDiscountForm">
			<div class="input-container">
				<input type="text" id="discountCode" name="code" placeholder="Discount Code" required>
			</div>
			<div class="input-container">
				<input type="number" id="discountValue" name="discount_value" placeholder="Discount Value" step="0.01" required>
			</div>
			<div class="input-container">
				<input type="date" id="discountStart" name="start_date" placeholder="Start Date">
			</div>
			<div class="input-container">
				<input type="date" id="discountExpir" name="end_date" placeholder="Expiration Date">
			</div>
			<div class="input-container">
				<input type="number" id="minOrderAmount" name="min_order_amount" placeholder="Minimum Order Amount" step="0.01">
			</div>
			<div class="input-container">
				<label>
					<input type="checkbox" id="discountActive" name="active" checked>
					Active
				</label>
			</div>
			<button type="submit">Create Discount</button>
		</form>
		
		<h2>Delete Discount</h2>
		<form id="deleteDiscountForm">
			<div class="input-container">
				<input type="text" id="deleteDiscountId" name="discount_id" placeholder="Discount ID" required>
			</div>
			<button type="submit">Delete</button>
		</form>
		
	</div>
	<div class="right-content">
		<h2>Current Discounts</h2>
		<div id="discountsList"></div>
	</div>
</div>
<script>
	function fetchDiscounts() {
		fetch('/api/discounts')
			.then(response => response.json())
			.then(discounts => {
				const discountsList = document.getElementById('discountsList');
				discountsList.innerHTML = '';
				discounts.forEach(discount => {
					discountsList.innerHTML += `
						<div>
							<h3>${discount.code}</h3>
							<p>ID: ${discount.discount_id}</p>
							<p>Value: ${discount.discount_value}</p>
							<p>Start Date: ${discount.start_date || 'N/A'}</p>
							<p>End Date: ${discount.end_date || 'N/A'}</p>
							<p>Min Order Amount: ${discount.min_order_amount || 'N/A'}</p>
							<p>Active: ${discount.active ? 'Yes' : 'No'}</p>
						</div>
						<hr>
					`;
				});
			})
			.catch(error => console.error('Error:', error));
	}

	// Fetch discounts on page load
	fetchDiscounts();

	// Handle create discount form submission
	document.getElementById('createDiscountForm').addEventListener('submit', function(e) {
		e.preventDefault();
		const formData = new FormData(this);
		const discount = Object.fromEntries(formData.entries());
		discount.active = discount.active === 'on';

		fetch('/api/discounts', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
			},
			body: JSON.stringify(discount),
		})
		.then(response => response.json())
		.then(data => {
			console.log('Success:', data);
			fetchDiscounts(); // Refresh the discounts list
			this.reset(); // Reset the form
		})
		.catch((error) => {
			console.error('Error:', error);
		});
	});

	// Handle delete discount form submission
	document.getElementById('deleteDiscountForm').addEventListener('submit', function(e) {
		e.preventDefault();
		const discountId = document.getElementById('deleteDiscountId').value;

		fetch(`/api/discounts/${discountId}`, {
			method: 'DELETE',
		})
		.then(response => response.json())
		.then(data => {
			console.log('Success:', data);
			fetchDiscounts(); // Refresh the discounts list
			this.reset(); // Reset the form
		})
		.catch((error) => {
			console.error('Error:', error);
		});
	});
</script>

</body>
</html>